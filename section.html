<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Pi√®ces jointes</title>
    <link rel="stylesheet" href="https://p.trellocdn.com/power-up.min.css">
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 8px;
            margin: 0;
            background: transparent;
        }
        .download-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 10px 16px;
            background: #0079bf;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            box-sizing: border-box;
        }
        .download-btn:hover {
            background: #026aa7;
        }
        .no-files {
            color: #5e6c84;
            font-size: 13px;
            font-style: italic;
            text-align: center;
            padding: 8px;
        }
        .info {
            font-size: 12px;
            color: #5e6c84;
            text-align: center;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div id="content">Chargement...</div>

    <script>
        var t = TrelloPowerUp.iframe();
        var BASE_URL = 'https://joprowork.github.io/mon_power_up_tout_telecharger';
        
        t.render(function() {
            t.card('id', 'name', 'attachments').then(function(card) {
                var attachments = card.attachments || [];
                
                var fileAttachments = attachments.filter(function(att) {
                    return att.url && (att.mimeType || att.url.indexOf('trello') !== -1 || att.bytes > 0);
                });
                
                var contentEl = document.getElementById('content');
                
                if (fileAttachments.length === 0) {
                    contentEl.innerHTML = '<div class="no-files">Aucun fichier √† t√©l√©charger</div>';
                } else {
                    var cardId = encodeURIComponent(card.id);
                    var cardName = encodeURIComponent(card.name || 'carte');
                    var downloadUrl = BASE_URL + '/download.html?cardId=' + cardId + '&cardName=' + cardName;
                    
                    contentEl.innerHTML = 
                        '<a href="' + downloadUrl + '" target="_blank" class="download-btn">' +
                        'üì• T√©l√©charger ' + fileAttachments.length + ' fichier(s) en ZIP' +
                        '</a>' +
                        '<div class="info">Un nouvel onglet va s\'ouvrir pour cr√©er le ZIP</div>';
                }
                
                t.sizeTo('#content').catch(function() {});
            });
        });
    </script>
</body>
</html>
